<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Manager</title>
    <!-- Подключение Bootstrap для стилизации -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>

<button id="startTasks" class="btn btn-primary">Выполнить задачу</button>
<!-- Список для отображения задач -->
<ul id="taskList" class="list-group mt-3"></ul>

<script>
    // Привязываем функцию manageTasks к событию onclick кнопки startTasks
    document.getElementById('startTasks').onclick = manageTasks;

    // Функция для генерации случайного числа от 0 до max
    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }

    // Функция, которая возвращает Promise для выполнения задачи случайным образом
    function randomCompletion(task) {
        return new Promise((resolve, reject) => {
            let whenIDo = getRandomInt(5) * 1000;
            const shouldComplete = Math.random() < 0.5; // 50% вероятность выполнения

            // Устанавливаем задержку перед выполнением задачи
            setTimeout(() => {
                if (shouldComplete) {
                    resolve(`${task.description} - выполнено`); // Задача выполнена
                } else {
                    reject(`${task.description} - не выполнено`); // Задача не выполнена
                }
            }, whenIDo);
        });
    }

    // Функция для управления задачами
    function manageTasks() {
        // Массив задач с описанием и важностью
        const tasks = [
            { description: 'Вынести ёлку', importance: 2 },
            { description: 'Сделать уборку в квартире', importance: 3 },
            { description: 'Приготовить обед', importance: 1 }
        ];

        const taskList = document.getElementById('taskList'); // Получаем элемент списка задач
        taskList.innerHTML = '';

        // Сортируем задачи по важности в порядке убывания
        tasks.sort((a, b) => b.importance - a.importance);

        // Создаем массив обещаний (Promise) для каждой задачи
        const promises = tasks.map(task => randomCompletion(task));

        // Обрабатываем все обещания и отображаем результаты
        Promise.allSettled(promises).then(results => {
            results.forEach(result => {
                const li = document.createElement('li'); // Создаем новый элемент списка
                li.className = 'list-group-item'; // Добавляем класс для стилизации
                if (result.status === 'fulfilled') {
                    li.textContent = result.value; // Текст для выполненной задачи
                    li.classList.add('list-group-item-success'); // Класс для успешной задачи
                } else {
                    li.textContent = result.reason; // Текст для невыполненной задачи
                    li.classList.add('list-group-item-danger'); // Класс для ошибки
                }
                taskList.appendChild(li); // Добавляем элемент в список
            });
        });
    }
</script>

</body>
</html>